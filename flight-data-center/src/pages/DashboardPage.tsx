import React, {useState} from 'react';
import NavbarUI from "../components/NavbarUI";
import {YMaps, Map, Circle, Clusterer, Placemark} from '@pbe/react-yandex-maps';

const VerticalLine: React.FC<{ height: number; top: number; left: number; text: string }> = ({
                                                                                                 height,
                                                                                                 top,
                                                                                                 left,
                                                                                                 text,
                                                                                             }) => {
    return (
        <div
            className="absolute flex flex-col items-center"
            style={{ top: `${top}px`, left: `${left}px` }}
        >
            <div className="relative border-l-2 border-black" style={{ height: `${height}px` }}>
        <span className="absolute top-1/2 -left-10 transform -translate-y-1/2 bg-white px-2 flex items-center w-full">
          {text}
        </span>
                <div
                    className="before:absolute before:border-5 before:border-transparent before:border-b-black
                    before:content-[''] before:top-[-10px] before:left-[-5px]
                    after:absolute after:border-5 after:border-transparent after:border-t-black
                    after:content-[''] after:bottom-[-10px] after:left-[-5px]"
                />
            </div>
        </div>
    );
};

const DashboardPage: React.FC = () =>  {
    const MAX_DRONE_VISUALIZATION_HEIGHT: number = 100; // in display PX

    const svgDroneIcon = `
        <svg height="800px" width="800px" version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
            \t viewBox="0 0 512 512"  xml:space="preserve">
            <g>
            \t<path class="st0" d="M133.5,133.503c-5.298,5.29-5.298,13.866,0,19.164c5.298,5.298,13.874,5.298,19.172,0
            \t\tc5.28-5.298,5.28-13.874,0-19.164C147.373,128.206,138.798,128.206,133.5,133.503z"/>
            \t<path class="st0" d="M153.467,126.93l5.751,5.77l42.426-42.418c0.924-0.924,1.292-2.277,0.958-3.543
            \t\tc-0.325-1.275-1.318-2.268-2.576-2.628l-4.279-1.207c-5.469-1.523-11.34,0.018-15.354,4.04l-21.936,21.945
            \t\tC158.456,108.889,160.758,119.638,153.467,126.93z"/>
            \t<path class="st0" d="M132.712,159.213l-5.777-5.751l-42.408,42.408c-0.933,0.941-1.293,2.285-0.968,3.551
            \t\tc0.334,1.275,1.318,2.277,2.585,2.62l4.279,1.207c5.461,1.532,11.323-0.008,15.346-4.022l21.945-21.945
            \t\tC127.714,177.281,125.411,166.523,132.712,159.213z"/>
            \t<path class="st0" d="M378.51,152.667c5.289-5.298,5.289-13.874,0-19.164c-5.29-5.297-13.874-5.297-19.18,0
            \t\tc-5.28,5.29-5.28,13.866,0,19.164C364.636,157.965,373.22,157.965,378.51,152.667z"/>
            \t<path class="st0" d="M379.297,126.93l5.768,5.77l42.426-42.418c0.924-0.924,1.284-2.277,0.959-3.543
            \t\tc-0.334-1.275-1.318-2.268-2.586-2.628l-4.278-1.207c-5.47-1.523-11.332,0.018-15.346,4.04l-21.945,21.945
            \t\tC384.295,108.889,386.598,119.638,379.297,126.93z"/>
            \t<path class="st0" d="M358.56,159.213l-5.777-5.751l-42.418,42.408c-0.932,0.941-1.292,2.285-0.967,3.551
            \t\tc0.325,1.275,1.318,2.277,2.584,2.62l4.28,1.207c5.46,1.532,11.332-0.008,15.346-4.022l21.936-21.945
            \t\tC353.544,177.281,351.258,166.523,358.56,159.213z"/>
            \t<path class="st0" d="M133.5,359.333c-5.298,5.307-5.298,13.882,0,19.172c5.298,5.289,13.874,5.289,19.172,0
            \t\tc5.28-5.289,5.28-13.865,0-19.172C147.373,354.053,138.798,354.053,133.5,359.333z"/>
            \t<path class="st0" d="M153.467,352.787l5.751,5.768l42.426-42.426c0.924-0.924,1.292-2.276,0.958-3.544
            \t\tc-0.325-1.275-1.318-2.276-2.576-2.627l-4.279-1.207c-5.469-1.523-11.34,0.018-15.354,4.023l-21.936,21.953
            \t\tC158.456,334.727,160.758,345.485,153.467,352.787z"/>
            \t<path class="st0" d="M132.712,385.069l-5.777-5.769l-42.408,42.418c-0.933,0.932-1.293,2.285-0.968,3.552
            \t\tc0.334,1.275,1.318,2.26,2.585,2.619l4.279,1.198c5.461,1.532,11.323,0,15.346-4.023l21.945-21.936
            \t\tC127.714,403.129,125.411,392.362,132.712,385.069z"/>
            \t<path class="st0" d="M359.329,359.333c-5.28,5.307-5.28,13.882,0,19.172c5.307,5.289,13.891,5.289,19.18,0
            \t\tc5.289-5.289,5.289-13.865,0-19.172C373.22,354.053,364.636,354.053,359.329,359.333z"/>
            \t<path class="st0" d="M379.297,352.787l5.768,5.768l42.426-42.426c0.924-0.924,1.284-2.276,0.959-3.544
            \t\tc-0.334-1.275-1.318-2.276-2.586-2.627l-4.278-1.207c-5.47-1.523-11.332,0.018-15.346,4.023l-21.945,21.953
            \t\tC384.295,334.727,386.598,345.485,379.297,352.787z"/>
            \t<path class="st0" d="M358.56,385.069l-5.777-5.769l-42.418,42.418c-0.932,0.932-1.292,2.285-0.967,3.552
            \t\tc0.325,1.275,1.318,2.26,2.584,2.619l4.28,1.198c5.46,1.532,11.332,0,15.346-4.023l21.936-21.936
            \t\tC353.544,403.129,351.258,392.362,358.56,385.069z"/>
            \t<path class="st0" d="M456.779,255.996c11.896-9.26,22.304-20.378,30.768-32.908c7.72-11.417,13.832-24.016,18.016-37.47
            \t\tc4.185-13.445,6.436-27.772,6.436-42.536c0-19.711-4.014-38.574-11.255-55.7c-10.869-25.702-28.988-47.51-51.814-62.932
            \t\tc-11.418-7.703-24.008-13.814-37.462-18.008c-13.446-4.185-27.773-6.436-42.554-6.436c-19.685,0-38.566,4.006-55.683,11.255
            \t\tc-22.672,9.594-42.332,24.829-57.224,43.966c-9.269-11.922-20.396-22.304-32.926-30.777c-11.408-7.703-24.007-13.814-37.461-18.008
            \t\tc-13.445-4.185-27.764-6.436-42.537-6.436c-19.71,0-38.574,4.006-55.708,11.255C61.683,22.129,39.892,40.247,24.462,63.083
            \t\tc-7.712,11.4-13.84,23.999-18.025,37.47C2.26,113.999,0,128.3,0,143.081c0,19.71,4.015,38.557,11.255,55.692
            \t\tc9.595,22.68,24.838,42.332,43.966,57.224c-11.896,9.278-22.304,20.387-30.759,32.917c-7.712,11.408-13.84,24.015-18.025,37.461
            \t\tC2.26,339.837,0,354.155,0,368.911c0,19.71,4.015,38.574,11.255,55.7c10.87,25.71,28.988,47.517,51.814,62.94
            \t\tc11.418,7.72,24.008,13.83,37.479,18.016c13.446,4.176,27.765,6.435,42.537,6.428c19.703,0.008,38.566-4.006,55.683-11.255
            \t\tc22.681-9.594,42.332-24.837,57.224-43.966c9.278,11.914,20.396,22.313,32.926,30.777c11.417,7.72,24.016,13.83,37.461,18.016
            \t\tc13.472,4.176,27.782,6.435,42.537,6.428c19.702,0.008,38.574-4.006,55.7-11.255c25.71-10.869,47.517-28.988,62.932-51.814
            \t\tc7.72-11.409,13.832-24.016,18.016-37.47C509.748,398.019,512,383.7,512,368.911c0-19.694-4.014-38.557-11.255-55.674
            \t\tC491.151,290.556,475.925,270.905,456.779,255.996z M233.996,424.191c-7.986,13.121-18.744,24.392-31.445,32.968
            \t\tc-8.491,5.734-17.846,10.262-27.816,13.378c-9.996,3.107-20.6,4.784-31.65,4.784c-14.738,0-28.697-2.987-41.407-8.353
            \t\tc-19.069-8.071-35.356-21.576-46.825-38.583c-5.734-8.481-10.27-17.836-13.385-27.816c-3.098-9.98-4.776-20.583-4.776-31.658
            \t\tc0-14.73,2.969-28.681,8.362-41.398c8.045-19.069,21.568-35.348,38.557-46.808c1.369-0.941,2.79-1.823,4.202-2.696h110.552
            \t\tc13.104,7.994,24.376,18.744,32.952,31.445c0.924,1.378,1.814,2.782,2.679,4.202V424.191z M233.996,198.361
            \t\tc-7.986,13.112-18.744,24.358-31.445,32.96c-1.379,0.916-2.782,1.814-4.194,2.67H87.804c-13.112-7.977-24.375-18.735-32.952-31.436
            \t\tc-5.734-8.499-10.27-17.845-13.385-27.833c-3.098-9.98-4.776-20.592-4.776-31.642c0-14.747,2.969-28.689,8.362-41.407
            \t\tc8.045-19.069,21.568-35.347,38.557-46.842c8.498-5.718,17.844-10.253,27.824-13.36c9.98-3.107,20.584-4.776,31.65-4.776
            \t\tc14.73,0,28.68,2.97,41.399,8.345c19.077,8.062,35.355,21.568,46.833,38.566c0.924,1.386,1.814,2.79,2.679,4.211V198.361z
            \t\t M278.005,87.8c8.002-13.112,18.752-24.375,31.462-32.968c8.473-5.718,17.828-10.253,27.816-13.36
            \t\tc9.98-3.107,20.584-4.776,31.633-4.776c14.755,0,28.697,2.97,41.407,8.345c19.069,8.062,35.356,21.568,46.825,38.566
            \t\tc5.743,8.499,10.278,17.845,13.386,27.833c3.107,9.979,4.775,20.592,4.775,31.641c0,14.738-2.969,28.689-8.336,41.407
            \t\tc-8.071,19.06-21.585,35.34-38.574,46.834c-1.378,0.916-2.781,1.814-4.211,2.67H313.626c-13.095-7.986-24.367-18.735-32.925-31.436
            \t\tc-0.933-1.386-1.823-2.79-2.696-4.211V87.8z M466.972,410.318c-8.071,19.069-21.585,35.356-38.574,46.842
            \t\tc-8.507,5.734-17.853,10.262-27.824,13.378c-9.98,3.107-20.592,4.784-31.659,4.784c-14.73,0-28.68-2.987-41.407-8.353
            \t\tc-19.069-8.071-35.339-21.576-46.808-38.583c-0.933-1.369-1.823-2.773-2.696-4.202V313.647
            \t\tc8.002-13.112,18.743-24.375,31.462-32.943c1.369-0.941,2.773-1.823,4.202-2.696h110.527c13.121,7.994,24.384,18.744,32.952,31.445
            \t\tc5.743,8.49,10.278,17.837,13.386,27.833c3.107,9.971,4.775,20.576,4.775,31.625C475.308,383.675,472.339,397.608,466.972,410.318z
            \t\t"/>
            \t<path class="st0" d="M209.15,123.404c3.27,11.999,3.252,24.846,0.018,36.777c-3.227,11.939-9.732,22.912-18.539,31.47
            \t\tc-8.79,8.602-19.856,14.764-31.71,17.657c-11.854,2.918-24.435,2.585-36.058-0.882l-2.482,8.73
            \t\tc13.249,3.628,27.396,3.646,40.594,0.068c13.189-3.561,25.317-10.716,34.792-20.421c9.483-9.714,16.33-21.927,19.548-35.031
            \t\tc3.227-13.103,2.893-27.002-0.932-39.875L209.15,123.404z"/>
            \t<path class="st0" d="M74.085,125.116c3.226-11.922,9.722-22.903,18.529-31.47c8.798-8.601,19.857-14.764,31.719-17.657
            \t\tc11.845-2.901,24.435-2.567,36.049,0.899l2.49-8.748c-13.249-3.62-27.422-3.628-40.602-0.06
            \t\tc-13.189,3.552-25.308,10.724-34.791,20.43c-9.492,9.697-16.33,21.91-19.54,35.022c-3.235,13.103-2.893,27.011,0.925,39.866
            \t\tl5.237-1.489C70.824,149.894,70.841,137.055,74.085,125.116z"/>
            \t<path class="st0" d="M435.014,160.181c-3.236,11.939-9.74,22.912-18.538,31.47c-8.799,8.602-19.865,14.764-31.719,17.657
            \t\tc-11.845,2.918-24.426,2.585-36.05-0.882l-2.482,8.73c13.241,3.628,27.397,3.646,40.586,0.068
            \t\tc13.197-3.561,25.317-10.716,34.8-20.421c9.491-9.714,16.321-21.927,19.548-35.031c3.226-13.103,2.892-27.002-0.942-39.875
            \t\tl-5.229,1.507C438.258,135.403,438.241,148.25,435.014,160.181z"/>
            \t<path class="st0" d="M299.95,161.91c-3.279-12.016-3.261-24.855-0.018-36.794c3.227-11.922,9.723-22.903,18.538-31.47
            \t\tc8.791-8.601,19.848-14.764,31.702-17.657c11.854-2.901,24.427-2.567,36.05,0.899l2.491-8.748
            \t\tc-13.241-3.62-27.413-3.628-40.586-0.06c-13.197,3.552-25.334,10.724-34.8,20.43c-9.5,9.697-16.321,21.91-19.547,35.022
            \t\tc-3.236,13.103-2.893,27.011,0.932,39.866L299.95,161.91z"/>
            \t<path class="st0" d="M434.989,349.243c3.269,12.008,3.252,24.854,0.026,36.785c-3.236,11.922-9.74,22.903-18.538,31.47
            \t\tc-8.799,8.593-19.865,14.764-31.719,17.657c-11.845,2.901-24.426,2.584-36.05-0.898l-2.482,8.747
            \t\tc13.241,3.62,27.397,3.629,40.586,0.068c13.197-3.552,25.317-10.715,34.8-20.438c9.491-9.689,16.321-21.91,19.548-35.022
            \t\tc3.226-13.096,2.892-27.003-0.942-39.866L434.989,349.243z"/>
            \t<path class="st0" d="M299.932,350.963c3.227-11.93,9.723-22.894,18.538-31.47c8.791-8.601,19.848-14.763,31.702-17.656
            \t\tc11.854-2.902,24.427-2.576,36.05,0.89l2.491-8.746c-13.241-3.62-27.413-3.62-40.586-0.052c-13.197,3.552-25.334,10.724-34.8,20.43
            \t\tc-9.5,9.696-16.321,21.91-19.547,35.014c-3.236,13.112-2.893,27.02,0.932,39.875l5.238-1.498
            \t\tC296.671,375.741,296.688,362.903,299.932,350.963z"/>
            \t<path class="st0" d="M209.15,349.243c3.27,12.008,3.252,24.854,0.018,36.785c-3.227,11.922-9.732,22.903-18.539,31.47
            \t\tc-8.79,8.593-19.856,14.764-31.71,17.657c-11.854,2.901-24.435,2.584-36.058-0.898l-2.482,8.747
            \t\tc13.249,3.62,27.396,3.629,40.594,0.068c13.189-3.552,25.317-10.715,34.792-20.438c9.483-9.689,16.33-21.91,19.548-35.022
            \t\tc3.227-13.096,2.893-27.003-0.932-39.866L209.15,349.243z"/>
            \t<path class="st0" d="M74.085,350.963c3.226-11.93,9.722-22.894,18.529-31.47c8.798-8.601,19.857-14.763,31.719-17.656
            \t\tc11.845-2.902,24.435-2.576,36.049,0.89l2.49-8.746c-13.249-3.62-27.422-3.62-40.602-0.052
            \t\tc-13.189,3.552-25.308,10.724-34.791,20.43c-9.492,9.696-16.33,21.91-19.54,35.014c-3.235,13.112-2.893,27.02,0.925,39.875
            \t\tl5.237-1.498C70.824,375.741,70.841,362.903,74.085,350.963z"/>
            </g>
            </svg>
  `;

    const [backPack, setBackPack] = useState<boolean>(true);
    const [drones, setDrones] = useState<any>([
        {
            lat: 47.203113,
            lng: 38.935530,
            height: 1000,
        }
    ]);
    const [droneHeight, setDroneHeight] = useState<number>(drones[0].height);

    function processingDroneHeight(height: number): number {
        if (height >= MAX_DRONE_VISUALIZATION_HEIGHT) {
            return MAX_DRONE_VISUALIZATION_HEIGHT;
        } else {
            return height;
        }
    }

    function processingDroneHeightPx(height: number) {
        return processingDroneHeight(height) + "px";
    }

    function closeBackPack() {
        setBackPack(true);
    }

    function openBackPack() {
        setBackPack(false);
    }

    return (<>

        <div className={`flex flex-cols w-full items-center`}>
            <div className="w-1/4 h-screen p-4 space-y-4">
                <h1 className={'text-center font-bold'}>Квадрокоптер #1</h1>
                <div className="w-full rounded-md flex items-center justify-center bg-black h-[300px]">
                    <p className={'text-gray-300'}>Video Capture...</p>
                </div>
                <div className="rounded-md relative border-1 border-gray-100 p-4">
                    <div className={'relative w-[300px]'}>
                        {/* Верняя и Нижняя основы */}
                        <div className="absolute top-0 left-0 w-[300px] h-1 bg-black"></div>
                        <div className="absolute top-[60px] left-0 w-[300px] h-1 bg-black"></div>

                        {/* Нижние болты - Шаси */}
                        <div className="absolute top-[64px] left-[10px] w-1 h-[60px] bg-gray-300"></div>
                        <div className="absolute top-[64px] right-[10px] w-1 h-[60px] bg-gray-300"></div>

                        {/* Внутрение болты - боковые */}
                        <div className="absolute top-[4px] left-[10px] w-1 h-[56px] bg-gray-300"></div>
                        <div className="absolute top-[4px] right-[10px] w-1 h-[56px] bg-gray-300"></div>


                        {/* Внутрение болты - средние */}
                        <div className="absolute top-[4px] left-[118px] w-1 h-[56px] bg-gray-300"></div>
                        <div className="absolute top-[4px] right-[118px] w-1 h-[56px] bg-gray-300"></div>

                        {/* Левые двигатель */}
                        <div className="absolute top-[7px] left-[16px] w-[100px] h-[50px] bg-green-100 flex items-center justify-center">
                            <p>Левый</p>
                        </div>

                        {/* Правые двигатель */}
                        <div className="absolute top-[7px] right-[16px] w-[100px] h-[50px] bg-green-100 flex items-center justify-center">
                            <p>Правый</p>
                        </div>
                    </div>

                    <VerticalLine height={processingDroneHeight(droneHeight)} top={processingDroneHeight(droneHeight)} left={100} text={processingDroneHeight(droneHeight) + " М"} />

                    <svg width="300" height="200" xmlns="http://www.w3.org/2000/svg" style={{ marginTop: `${processingDroneHeightPx(droneHeight)}` }}>
                        <path d="M0,150 L20,148 L40,152 L60,149 L80,151 L100,150 L120,149 L140,151 L160,150 L180,148 L200,152 L220,150 L240,149 L260,151 L280,150 L300,148 L320,152 L340,150 L360,149 L380,151 L400,150 L420,148 L440,152 L460,150 L480,149 L500,151"
                              fill="none" stroke="sienna" stroke-width="3" />
                    </svg>
                </div>
            </div>

            <div className="w-full h-screen relative z-0">
                <div className="w-full absolute top-0 left-0 flex items-center justify-center pt-4 pb-2 z-50">
                    <NavbarUI />
                </div>
                <YMaps>
                    <Map defaultState={{ center: [drones[0].lat, drones[0].lng], zoom: 12 }} width={"100%"} height={"100%"}>
                        <Circle
                            geometry={[[drones[0].lat, drones[0].lng], 35]}
                            options={{
                                draggable: false,
                                fillColor: "#DB709377",
                                strokeColor: "#990066",
                                strokeOpacity: 0.8,
                                strokeWidth: 5,
                            }}
                        />
                        <Clusterer
                            options={{
                                preset: "islands#invertedVioletClusterIcons",
                                groupByCoordinates: false,
                            }}
                        >
                            {drones?.map((drone:any, index:any) => (
                                <Placemark key={index} geometry={{ type: "Point", coordinates: [drone.lat, drone.lng] }} options={{
                                    iconLayout: 'default#image',
                                    iconImageHref: `data:image/svg+xml;charset=utf-8,${encodeURIComponent(svgDroneIcon)}`,
                                    iconImageSize: [50, 50],
                                }} />
                            ))}
                        </Clusterer>
                        {
                            (!backPack) ? <Placemark geometry={{ type: "Point", coordinates: [drones[0].lat, drones[0].lng] }} /> : ""
                        }
                    </Map>
                </YMaps>
            </div>

            <div className="w-1/4 h-screen p-4">
                <div className="shadow p-2 rounded-md ring-1 border-1 border-gray-100 space-y-4">
                    <h2 className={'text-center font-bold'}>Управление полезной нагрузкой</h2>
                    <p>Статус:
                        {
                            (backPack) ? <span className={'font-bold text-green-600'}>Закрыто</span> : <span className={'font-bold text-red-600'}>Сброшено</span>
                        }
                    </p>

                    {
                        (backPack) ? <button type={'button'} className={'w-full py-2 font-bold bg-red-400 hover:bg-red-500 rounded-md'} onClick={() => openBackPack()}>Сбросить</button> : ""
                    }
                </div>
            </div>
        </div>

    </>);
}

export default DashboardPage;